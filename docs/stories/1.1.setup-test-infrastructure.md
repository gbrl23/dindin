# Story 1.1: Configurar Infraestrutura de Testes

## Status

Done

## Story

**As a** desenvolvedor,
**I want** ter um test runner configurado no projeto,
**so that** eu possa escrever e executar testes automatizados para os hooks financeiros criticos.

## Acceptance Criteria

1. Vitest configurado como test runner no projeto com script `npm test` funcional
2. Configuracao de coverage report habilitada
3. Arquivo de exemplo de teste criado e passando
4. `package.json` atualizado com dependencias de teste (vitest, @testing-library/react, @testing-library/jest-dom, jsdom)
5. Pasta de testes segue convencao co-located (`*.test.js` junto ao arquivo testado)

## CodeRabbit Integration

> **CodeRabbit Integration**: Disabled
>
> CodeRabbit CLI is not enabled in `core-config.yaml`.
> Quality validation will use manual review process only.
> To enable, set `coderabbit_integration.enabled: true` in core-config.yaml

## Tasks / Subtasks

- [ ] Task 1: Instalar dependencias de teste (AC: 4)
  - [ ] 1.1 Executar `npm install -D vitest @testing-library/react @testing-library/jest-dom jsdom`
  - [ ] 1.2 Verificar que `package.json` foi atualizado corretamente nas devDependencies

- [ ] Task 2: Configurar Vitest no `vite.config.js` (AC: 1, 2)
  - [ ] 2.1 Adicionar bloco `test` na configuracao do Vite com: `globals: true`, `environment: 'jsdom'`, `setupFiles: './src/test/setup.js'`, `css: true`
  - [ ] 2.2 Habilitar coverage com provider `v8`: `coverage: { provider: 'v8', reporter: ['text', 'html', 'lcov'], reportsDirectory: './coverage' }`

- [ ] Task 3: Criar arquivo de setup de testes (AC: 1)
  - [ ] 3.1 Criar `src/test/setup.js` com import de `@testing-library/jest-dom`

- [ ] Task 4: Adicionar scripts no `package.json` (AC: 1, 2)
  - [ ] 4.1 Adicionar script `"test": "vitest run"`
  - [ ] 4.2 Adicionar script `"test:watch": "vitest"`
  - [ ] 4.3 Adicionar script `"test:coverage": "vitest run --coverage"`

- [ ] Task 5: Criar teste de exemplo co-located (AC: 3, 5)
  - [ ] 5.1 Criar `src/utils/dateUtils.test.js` com teste basico de `parseLocalDate`
  - [ ] 5.2 Verificar que teste passa com `npm test`
  - [ ] 5.3 Verificar que convencao co-located esta funcionando (arquivo `.test.js` junto ao modulo)

- [ ] Task 6: Validacao final
  - [ ] 6.1 Executar `npm test` e verificar que todos os testes passam
  - [ ] 6.2 Executar `npm run test:coverage` e verificar que report e gerado
  - [ ] 6.3 Executar `npm run lint` e verificar que nao ha erros introduzidos
  - [ ] 6.4 Executar `npm run build` e verificar que build continua funcional

## Dev Notes

### Arquitetura Relevante

**Stack do projeto:**
- React 19.2.0 + Vite 7.2.4 (SPA)
- JavaScript (JSX) — sem TypeScript
- ESLint configurado (`eslint.config.js`, flat config)
- Sem testes automatizados existentes

[Source: docs/prd.md#Section 4 - Technical Assumptions]

**Estrutura de diretorios relevante:**
```
src/
├── hooks/          # Hooks a serem testados nas proximas stories
│   ├── useBalanceCalculator.js
│   ├── useSharePayments.js
│   ├── useCards.js
│   ├── useGroups.js
│   ├── useCategories.js
│   └── ...
├── utils/          # Utilitarios (bom candidato para teste de exemplo)
│   ├── dateUtils.js
│   ├── validation.js
│   └── ...
├── contexts/       # Context providers
└── features/       # Feature modules
```

[Source: docs/architecture/technical-architecture.md#Section 6]

**Vite config atual (`vite.config.js`):**
```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
})
```
O bloco `test` deve ser adicionado ao mesmo `defineConfig`. Vitest le do `vite.config.js` nativamente (nao precisa de `vitest.config.js` separado).

[Source: Analise direta do arquivo vite.config.js]

**package.json atual — scripts:**
```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  }
}
```
Nao existe `npm test` atualmente. Sera adicionado nesta story.

[Source: Analise direta do arquivo package.json]

**Dependencias a instalar:**
```bash
npm install -D vitest @testing-library/react @testing-library/jest-dom jsdom
```

[Source: docs/architecture/technical-architecture.md#Section 10]

### Decisoes tecnicas

- **Co-located tests**: Arquivos `.test.js` junto ao modulo testado (ex: `useBalanceCalculator.test.js` em `src/hooks/`), nao em pasta `__tests__/` separada
- **jsdom environment**: Necessario para testes que usam React hooks (DOM virtual)
- **Coverage provider v8**: Built-in no Node, sem dependencia extra
- **Setup file**: `src/test/setup.js` importa `@testing-library/jest-dom` para matchers como `toBeInTheDocument()`

### Teste de exemplo sugerido

O teste de exemplo deve ser simples e testar um utilitario puro (sem dependencia de React). `src/utils/dateUtils.js` exporta `parseLocalDate` que e usado em multiplos hooks — bom candidato.

### Testing

**Convencao de teste para este projeto:**
- Localizacao: Co-located (`*.test.js` junto ao arquivo testado)
- Framework: Vitest (compativel com Vite, API similar ao Jest)
- DOM: jsdom (via `@testing-library/react`)
- Matchers: `@testing-library/jest-dom` (matchers extras para DOM)
- Coverage: v8 provider, reports em `./coverage/`
- Globals: `true` (dispensa `import { describe, it, expect }` de vitest)

## Change Log

| Date       | Version | Description              | Author           |
|------------|---------|--------------------------|------------------|
| 2026-02-21 | 1.0     | Story draft criado       | River (SM AI)    |

## Dev Agent Record

### Agent Model Used

_(A ser preenchido pelo dev agent)_

### Debug Log References

_(A ser preenchido pelo dev agent)_

### Completion Notes List

_(A ser preenchido pelo dev agent)_

### File List

_(A ser preenchido pelo dev agent)_

## QA Results

_(A ser preenchido pelo QA agent)_
